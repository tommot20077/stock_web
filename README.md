# 專案功能說明與開發進度

## 網站連接

[前往項目網站](https://stock.900303.xyz/)

帳號: guest@12345678.com  
密碼: a12345678

## 實作目的
因為在網路上比較沒有看到能夠同時整合各種不同類型(如虛擬貨幣、股票、貨幣、公債等)的資產價格、數量並計算投資收益、風險等等功能的方案，往往無法有效提供資產價格、數量的統一管理，而我自己本身也有這方面的需求，於實第二個專案就決定來開發一個能夠滿足這些需求的網站，幫助使用者掌控資產的變化與風險。

## 專案功能說明

### 會員系統

- **註冊與登入**  
  用戶可以註冊新帳號並登入系統以管理資產。系統支援持久化登入功能，即使在之後的訪問中也能保持登入狀態。提供一般網頁登入及使用 JWT 進行 API 驗證的兩種登入方式。  
  **狀態**: 已實現

- **資料編輯**  
  用戶可以更新個人資料，包括名稱、密碼、信箱、時區設定及偏好貨幣種類等。  
  **狀態**: 已實現

- **信箱驗證**  
  用戶在註冊時或註冊後可進行信箱驗證，以確保帳號的真實性與安全性。  
  **狀態**: 已實現

- **密碼找回**  
  已驗證信箱的用戶可以通過信箱進行密碼找回。  
  **狀態**: 已實現

### 資產系統

#### 資產檢視與訂閱

- **台灣股票**: 已實現
- **虛擬貨幣**: 已實現
- **貨幣**: 已實現
- **公債**: 已實現

#### 用戶資產管理

- **台灣股票**: 已實現
- **虛擬貨幣**: 已實現
- **貨幣**: 已實現
- **公債**: 未實現

#### 歷史資產價格圖表

- **台灣股票**: 已實現
- **虛擬貨幣**: 已實現
- **貨幣**: 不計畫實現
- **公債**: 不計畫實現

#### 即時資產價格圖表

- **台灣股票**: 已實現
- **虛擬貨幣**: 已實現
- **貨幣**: 已實現
- **公債**: 已實現

- **預計實現**: 美國股市、台灣期貨

### 用戶財產系統

- **資產管理**  
  用戶可以設定目前擁有的資產，系統提供資產變化及風險程度等資訊。  
  **狀態**: 已實現

- **交易紀錄**  
  用戶可以查看交易概況，系統會在用戶更新資產時自動記錄交易明細，並支援手動紀錄交易。  
  **狀態**: 已實現

- **資產訂閱**  
  用戶可以訂閱不同類型的資產，以獲取相關價格及資訊更新。  
  **狀態**: 已實現

- **資產概況統計**  
  系統根據用戶目前及歷史的資產變化，生成相關圖表（如 ROI、資產占比、回撤等）及報表，幫助用戶了解資產配置狀況。  
  **狀態**: 已實現

### 其他系統

- **資產新聞**  
  系統根據用戶訂閱的資產，提供相關的新聞資訊。  
  **狀態**: 已實現

- **商業新聞**  
  提供財經界重大新聞的綜合總覽。  
  **狀態**: 已實現

- **代辦事務**  
  用戶可以設定待辦事項並設定 Email 提醒，方便管理重要事件。  
  **狀態**: 已實現
  
- **管理系統**
  管理員能直接透過網頁內部的控制台對伺服器進行操作、控制以及狀態檢視。
  **狀態**: 已實現


## 實現方法

### 1. 項目架構

框架: 使用 Java Spring 框架實現，採用前後端分離的方案，前端基於模板進行開發，並依照需求補充額外的功能和 UI 設計，前後端的數據傳輸通過 fetch 來實現，項目架構分為 Controller 層、Service 層和 Repository 層三層架構。
### 2. 資料庫設計

#### MySQL

- **用戶資料**:  
  包括用戶名、密碼（經過 Argon2 加密算法處理）、郵箱、角色、偏好貨幣、相關憑證等。

- **用戶財產資料**:  
  根據不同的資產類型，紀錄用戶資產的數量、時間、備註、金額及交易明細等信息。

- **資產訊息資料**:  
  保存資產的 ID、類型、名稱或代號等。

- **系統事件**:  
  紀錄系統執行的操作，便於在程序中斷後重新執行，並且包含操作的時間點。

- **新聞資料**:  
  儲存相關資產或頭條新聞，提供用戶最新的市場動態。

- **代辦資料**:  
  保存用戶設定的提醒事項，並在系統啟動時重新設定提醒任務。

#### InfluxDB

- **用戶財產**:  
  以時間作為標籤紀錄用戶的資產金額、數量變化，以及資產變動的圖表數據。

- **資產訊息**:  
  保存各種資產的歷史及即時價格走勢，便於數據分析和顯示。

#### Redis

- **緩存**:  
  用於緩存所有用戶共通使用的資料如 K 線圖、新聞、資產列表、前綴樹等高頻率存取且更新頻率低的資料，提升回應速度。

### 3. 安全性設置

- **CSRF 保護**:  
  使用 Spring Security 中的 WebSecurityConfigurerAdapter 配置 CSRF 防護機制，防止跨站請求偽造攻擊。

- **用戶驗證與授權**:  
  基於用戶的角色(Role)來進行操作權限的檢查，確保不同角色的權限隔離。

- **JWT**:  
  使用 JWT（JSON Web Token）來驗證 API 請求者的身份和權限。
      
    



  

## 開發進度

### 2024-08-15
- **新增**: 新增:資產訊息搜尋系統(使用前綴樹數據結構)
- **修復**:個人資料更新時數據傳輸類型錯誤
- **優化**:錯誤控制器處理邏輯、頻繁的字串操作拼接改以StringBuilder或是StringBuffer處理

### 2024-07-01
- **修復**: 月和年的卡瑪比率錯誤顯示問題、夏普比率取得數據格式設計錯誤導致數據無法取得的錯誤、修復左側分頁缺少部分跳轉功能

### 2024-05-24
- **修復**: 交易總覽分頁按鈕錯誤位置
- **優化**: 資產圖表標示並保留上方空間

### 2024-05-20
- **新增**: 卡瑪比率、公債新聞以及相關資料表格圖表呈現、交易紀錄分頁功能
- **修復**: 虛擬貨幣初始化時前端狀態不顯示問題，查詢價格非空檢查錯誤
- **優化**: 前端顯示數據、轉換 ROI 圖表優化循環、虛擬貨幣 WebSocket 重試方法、初始化錯誤重新定義、說明文檔與配置文件文檔

### 2024-05-16
- **新增**: 最大回撤指標（修復回撤錯誤計算結果）

### 2024-05-14
- **新增**: 前端 ROI 歷史圖表、ROI 相關數據（波動率、夏普比率）、公債資料庫
- **優化**: Influx 查詢方法用 Map 來儲存過濾條件並支援 or 或 and 查詢條件篩選
- **修復**: 資產總覽無法顯示日收益以外的錯誤

### 2024-05-09
- **新增**: 設定檔的範例
- **優化**: 前端 K 線圖請求邏輯、Properties 部分設定的預設值、數值千分位顯示、前端重複代碼整合
- **修復**: 前端分頁請求錯誤、管理員控制台請求 URL 錯誤、用戶手動訂閱伺服器沒有請求資產資料

### 2024-05-07
- **新增**: 檔案說明文件
- **優化**: 整合部分代碼重複的邏輯

### 2024-05-06
- **新增**: 部分檔案說明文件、刪除已設定提醒任務功能
- **修復**: 資產新聞無法獲取、K 線數據緩存獲取錯誤

### 2024-05-05
- **新增**: 部分檔案說明文件

### 2024-05-03
- **新增**: 前端伺服器狀態檢視、待辦事項功能（使用 Mail 提示用戶）、部分檔案說明文件
- **修復**: 即時股價沒有成功轉換成基準貨幣

### 2024-05-02
- **新增**: 前端伺服器狀態檢視、部分檔案說明文件

### 2024-05-01
- **新增**: 台股即時股價連線控制
- **修復**: 貨幣金額獲取錯誤、線程關閉導致 Influx 查詢錯誤、貨幣資產無法刪除錯誤、台灣股票每月第一天無法獲取歷史資料錯誤
- **重構**: 資產價格轉換邏輯、前端獲取用戶資產金額的方式、Influx 台灣股票資料庫
- **優化**: 定時獲取台股股價的顯示、資料庫連線超時設定、用戶資產為空時重製個別資產資料

### 2024-04-30
- **新增**: Influx 資料庫配置檢查、補充管理員部分命令、重設密碼功能
- **修復**: 計算台股現金流沒有轉換成統一的貨幣導致後續計算 ROI 錯誤、沒有資產時寫入 Influx 會拋出錯誤、管理員權限設置錯誤、前端頁面不統一的規範、前端圖表沒有顯示轉換後的資產價格、資產為空時前端載入動畫錯誤
- **優化**: 代碼規範、登入註冊頁面對小型設備介面

### 2024-04-28
- **新增**: 前端的資產總列表
- **優化**: 新聞按時間排序、新聞跟資產 K 線的 Redis 資料格式、資產頁面前端錯誤請求、分離資產數據與 K 線數據請求、顯示資產名稱、部分實體序列化問題、分離資產資訊及新聞請求位置

### 2024-04-27
- **新增**: 資產頁面的新聞跟統計數據（補上用戶偏好貨幣轉換價格）、定時抓取訂閱新聞
- **優化**: Influx 查詢邏輯、新聞緩存、查詢邏輯

### 2024-04-26
- **新增**: Redis 緩存 K 線資料、資產頁面的價格 K 線圖

### 2024-04-24
- **新增**: 新聞系統、Redis 用於緩存新聞資料、首頁新聞顯示與分頁系統
- **修復**: 前端用戶數據錯誤的顯示資料、Influx 錯誤的查詢台股數據

### 2024-04-22
- **修復**: EventCacheMethod 依賴問題
- **新增**: 資產變動時更新資產金額並刪除緩存、前端首頁顯示資產概略數據

### 2024-04-21
- **新增**: 資產變動時更新資產金額並刪除緩存、事件緩存啟動時檢查處理
- **修復**: 有事件緩存存在時無法刪除資產錯誤

### 2024-04-20
- **新增**: Influx 的重試邏輯
- **優化**: 部分代碼邏輯以及合併部分重複性代碼

### 2024-04-19
- **新增**: 對虛擬貨幣歷史價格缺失部分會在每日更新時重新抓取、新增用戶現金流量以及 ROI 計算處理、事件緩存持久化處理（避免程式中斷導致資料消失）
- **優化**: 啟動程式初始化資料庫時不再讀取全部資料，改以分頁執行
- **修復**: 登入頁面的圖片讀取太久、Influx 查詢語句錯誤、最新價格太久沒更新則從歷史最新找取、計算跟取得 ROI 資料的錯誤、現金流量結果錯誤、更新現金流量時會找不到歷史資料
  
**2024-04-15**  
- **優化:** 所有 API 控制器的名稱以及路徑規範
- **新增:** 首頁的用戶資產狀態(一周折線圖以及資產占比圓餅圖)
---

**2024-04-14**  
- **新增:** 前端訂閱功能頁面
- **修復:** 取消訂閱加密貨幣時，如果沒有啟動webSocketSession會出現錯誤
---

**2024-04-12**  
- **新增:** 用戶訂閱刪除檢查(準備前端訂閱處理)、記錄用戶資產金額變化
- **修復:** 更新資產時會錯誤顯示備註、訂閱貨幣兌時如果貨幣交換順序造成雙重訂閱錯誤、修復貨幣兌更新時間導致的錯誤匯率
- **優化:** 統一代碼格式

---

**2024-04-10**  
- **新增:** 前端資產表格顯示當前資產的單價及總價
- **修復:** 資產資料庫為空的時候管理員及用戶無法登入錯誤、用戶更新貨幣後資料庫訂閱沒有變更的錯誤

---

**2024-04-09**  
- **修復:** 兩種不同的交易紀錄時間格式錯誤、錯誤的前端檔案位置、網頁出現混合內容的錯誤、交易紀錄時間時發生錯誤、資料抓取時錯誤時會停止後續任務
- **新增:** 虛擬貨幣訂閱的資料建立、刪除
- **優化:** 部分控制器的邏輯、更改股票資料抓取的限制器速度、前端靜態檔案位置更改、生產環境的設定檔預設設定

---

**2024-04-08**  
- **新增:** 虛擬貨幣歷史資料的多線程獲取以及管理、伺服器任務活動紀錄

---

**2024-04-06**  
- **新增:** 股票以及虛擬貨幣的歷史資料獲取
- **關閉:** 獲取歷史貨幣匯率資料(獲取難度太大)

---

**2024-04-04**  
- **重寫:** 虛擬貨幣即時資料中途訂閱更改檢測處理  
- **新增:** 股票即時資料中途訂閱更改檢測
- **修復:** 刪除資產時會需要提供不必要的資訊錯誤、前端新增資產時無法備註、交易紀錄貨幣無法正常被記錄、重新啟動WebSocket連接時關閉連接時錯誤訊息導致的錯誤

---

**2024-04-03**  
- **新增:** 訂閱的台灣股票及時價格

---

**2024-04-02**  
- **新增:** 前端交易紀錄頁面

---

**2024-04-01**  
- **新增:** 用戶交易紀錄
- **重寫:** 股市與虛擬貨幣的entity結構
- **重構:** 訂閱系統處理股票以及虛擬貨幣時訂閱流程
- **關閉:** 虛擬貨幣訂閱限制(暫時)

---

**2024-03-29**  
- **新增:** 前端用戶資產頁面(新增、修改、刪除、查看)
- **修復:** 後端接收資料錯誤格式時處理序列化問題

---

**2024-03-26**  
- **新增:** 用戶交易紀錄功能

---

**2024-03-25**  
- **新增:** 用戶資產修改功能

---

**2024-03-24**  
- **重寫:** 幣圈實體格式、處理資料及用戶訂閱方法(原本一次一個變成批量)
- **新增:** 當達到幣安的WebSocket最大限制連線時間時候自動重連功能

---

**2024-03-23**  
- **新增:** 台灣股票列表、訂閱資產訊息功能
- **重寫:** 用戶資產訊息訂閱邏輯、部分JPA實體格式
- **優化:** api使用邏輯
---

**2024-03-21**  
- **新增:** influx 時序化資料庫、使用 WebSocket 串接幣安交易所獲取價格(暫時限定每次訂閱最多1個)
- **修復:** WebSocket在重新連線時會出現RejectedExecutionException錯誤

---

**2024-03-19**  
- **優化:** API 依照使用權限、用途重新分類、更新資料使用異步處理、有關用戶token相關服務的業務邏輯分離、api依照用途分類
- **新增:** 貨幣匯率功能(歷史資料與現在資料分離)

---

**2024-03-17**  
- **新增:** 驗證信箱功能
- **重構:** 有關用戶憑證的資料庫設計

---

**2024-03-16**  
- **更新:** 用戶資料變更功能、錯誤頁面、錯誤網址重導向

---

**2024-03-14**  
- **更新:** 分開網頁登入與 API 的接口並加上 CSRF 保護
- **重構:** 用戶密碼的加密方法  
- **新增:** API 登入的 JWT 驗證、重新編輯用戶名稱功能

---

**2024-03-13**  
- **新增:** 登入註冊系統、持久化登入(使用 Security 管理用戶權限)

---
